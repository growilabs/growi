{"version":3,"file":"codemirror-editor.js","sources":["../../src/stores/codemirror-editor.ts"],"sourcesContent":["import { useMemo, useRef } from 'react';\n\nimport { useSWRStatic } from '@growi/core/dist/swr';\nimport type { ReactCodeMirrorProps, UseCodeMirror } from '@uiw/react-codemirror';\nimport type { SWRResponse } from 'swr';\nimport deepmerge from 'ts-deepmerge';\n\nimport type { UseCodeMirrorEditor } from '../services';\nimport { useCodeMirrorEditor } from '../services';\n\n\nconst isValid = (u: UseCodeMirrorEditor) => {\n  return u.state != null && u.view != null;\n};\n\nconst isDeepEquals = <T extends object>(obj1: T, obj2: T): boolean => {\n  const typedKeys = Object.keys(obj1) as (keyof typeof obj1)[];\n  return typedKeys.every(key => obj1[key] === obj2[key]);\n};\n\n\nexport const useCodeMirrorEditorIsolated = (\n    key: string | null, container?: HTMLDivElement | null, props?: ReactCodeMirrorProps,\n): SWRResponse<UseCodeMirrorEditor> => {\n\n  const ref = useRef<UseCodeMirrorEditor>();\n  const currentData = ref.current;\n\n  const swrKey = key != null ? `codeMirrorEditor_${key}` : null;\n  const mergedProps = useMemo<UseCodeMirror>(() => {\n    return deepmerge(\n      props ?? {},\n      {\n        container,\n      },\n    );\n  }, [container, props]);\n\n  const newData = useCodeMirrorEditor(mergedProps);\n\n  const shouldUpdate = swrKey != null && container != null && props != null && (\n    currentData == null\n    || (isValid(newData) && !isDeepEquals(currentData, newData))\n  );\n\n  if (shouldUpdate) {\n    ref.current = newData;\n    // eslint-disable-next-line no-console\n    console.info('Initializing codemirror for main');\n  }\n\n  return useSWRStatic(swrKey, shouldUpdate ? newData : undefined);\n};\n"],"names":["isValid","u","isDeepEquals","obj1","obj2","key","useCodeMirrorEditorIsolated","container","props","ref","useRef","currentData","swrKey","mergedProps","useMemo","deepmerge","newData","useCodeMirrorEditor","shouldUpdate","useSWRStatic"],"mappings":";;;;AAWA,MAAMA,IAAU,CAACC,MACRA,EAAE,SAAS,QAAQA,EAAE,QAAQ,MAGhCC,IAAe,CAAmBC,GAASC,MAC7B,OAAO,KAAKD,CAAI,EACjB,MAAM,CAAOE,MAAAF,EAAKE,CAAG,MAAMD,EAAKC,CAAG,CAAC,GAI1CC,IAA8B,CACvCD,GAAoBE,GAAmCC,MACpB;AAErC,QAAMC,IAAMC,KACNC,IAAcF,EAAI,SAElBG,IAASP,KAAO,OAAO,oBAAoBA,CAAG,KAAK,MACnDQ,IAAcC,EAAuB,MAClCC;AAAA,IACLP,KAAS,CAAC;AAAA,IACV;AAAA,MACE,WAAAD;AAAA,IACF;AAAA,EAAA,GAED,CAACA,GAAWC,CAAK,CAAC,GAEfQ,IAAUC,EAAoBJ,CAAW,GAEzCK,IAAeN,KAAU,QAAQL,KAAa,QAAQC,KAAS,SACnEG,KAAe,QACXX,EAAQgB,CAAO,KAAK,CAACd,EAAaS,GAAaK,CAAO;AAG5D,SAAIE,MACFT,EAAI,UAAUO,GAEd,QAAQ,KAAK,kCAAkC,IAG1CG,EAAaP,GAAQM,IAAeF,IAAU,MAAS;AAChE;"}